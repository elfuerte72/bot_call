from typing import Dict, List, Any, Optional
import random

# –§—É–Ω–∫—Ü–∏—è-–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–æ–≤ –ø–∏—Ç–∞–Ω–∏—è
async def generate_meal_plan(
    client_id: int,
    calories: float,
    protein: float,
    fat: float,
    carbs: float,
    goal: str,
    allergies: str = '',
    preferences: str = '',
    limitations: str = ''
) -> str:
    """
    –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å —Å —É—á–µ—Ç–æ–º –ö–ë–ñ–£ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    
    Args:
        client_id: ID –∫–ª–∏–µ–Ω—Ç–∞
        calories: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ª–æ—Ä–∏–π
        protein: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–ª–∫–∞ –≤ –≥—Ä–∞–º–º–∞—Ö
        fat: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ä–∞ –≤ –≥—Ä–∞–º–º–∞—Ö
        carbs: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≥–ª–µ–≤–æ–¥–æ–≤ –≤ –≥—Ä–∞–º–º–∞—Ö
        goal: –¶–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞
        allergies: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–ª–ª–µ—Ä–≥–∏—è—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        preferences: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ –µ–¥–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        limitations: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ –∏ –¥—Ä. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        
    Returns:
        –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    """
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
    restrictions_text = ""
    if allergies:
        restrictions_text += f"\nüö´ –ê–ª–ª–µ—Ä–≥–∏—è: {allergies}"
    if preferences:
        restrictions_text += f"\nüëç –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {preferences}"
    if limitations:
        restrictions_text += f"\n‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {limitations}"
    
    # –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ö–ë–ñ–£ –ø–æ –ø—Ä–∏–µ–º–∞–º –ø–∏—â–∏
    breakfast_percent = random.uniform(0.25, 0.30)
    lunch_percent = random.uniform(0.35, 0.40)
    dinner_percent = random.uniform(0.25, 0.30)
    snack_percent = 1 - (breakfast_percent + lunch_percent + dinner_percent)
    
    breakfast_cals = round(calories * breakfast_percent)
    lunch_cals = round(calories * lunch_percent)
    dinner_cals = round(calories * dinner_percent)
    snack_cals = round(calories * snack_percent)
    
    # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è
    sample_plan = f"""üìã –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å

üìä –û–±—â–∏–µ –ö–ë–ñ–£ –Ω–∞ –¥–µ–Ω—å:
üî• –ö–∞–ª–æ—Ä–∏–∏: {round(calories)} –∫–∫–∞–ª
ü•© –ë–µ–ª–∫–∏: {round(protein)} –≥
üßà –ñ–∏—Ä—ã: {round(fat)} –≥
üçö –£–≥–ª–µ–≤–æ–¥—ã: {round(carbs)} –≥
{restrictions_text}

üç≥ –ó–ê–í–¢–†–ê–ö (~{breakfast_cals} –∫–∫–∞–ª)
- –û–º–ª–µ—Ç –∏–∑ 2 —è–∏—Ü —Å –æ–≤–æ—â–∞–º–∏
- –ö–∞—à–∞ –æ–≤—Å—è–Ω–∞—è –Ω–∞ –º–æ–ª–æ–∫–µ 1%
- –¢–æ—Å—Ç –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–≥–æ —Ö–ª–µ–±–∞
- –ß–∞–π/–∫–æ—Ñ–µ –±–µ–∑ —Å–∞—Ö–∞—Ä–∞

ü•ó –û–ë–ï–î (~{lunch_cals} –∫–∫–∞–ª)
- –ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ –∑–∞–ø–µ—á–µ–Ω–Ω–∞—è 150–≥
- –ì—Ä–µ—á–∫–∞ –æ—Ç–≤–∞—Ä–Ω–∞—è 100–≥
- –°–∞–ª–∞—Ç –∏–∑ —Å–≤–µ–∂–∏—Ö –æ–≤–æ—â–µ–π —Å –æ–ª–∏–≤–∫–æ–≤—ã–º –º–∞—Å–ª–æ–º
- –ö–æ–º–ø–æ—Ç –∏–∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç–æ–≤ –±–µ–∑ —Å–∞—Ö–∞—Ä–∞

ü•© –£–ñ–ò–ù (~{dinner_cals} –∫–∫–∞–ª)
- –†—ã–±–∞ –∑–∞–ø–µ—á–µ–Ω–Ω–∞—è 150–≥
- –û–≤–æ—â–∏ –Ω–∞ –ø–∞—Ä—É 150–≥
- –†–∏—Å –±—É—Ä—ã–π 70–≥
- –ß–∞–π –∑–µ–ª–µ–Ω—ã–π

üçé –ü–ï–†–ï–ö–£–° (~{snack_cals} –∫–∫–∞–ª)
- –Ø–±–ª–æ–∫–æ
- –¢–≤–æ—Ä–æ–≥ 5% 100–≥
- –û—Ä–µ—Ö–∏ –º–∏–Ω–¥–∞–ª—å 15–≥

‚ùóÔ∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–æ—Ç–∞.
–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ –ø–ª–∞–Ω –±—É–¥–µ—Ç —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPT –∏ RAG-—Å–∏—Å—Ç–µ–º—ã.
"""
    return sample_plan
