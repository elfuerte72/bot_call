# Архитектура проекта Telegram-бота для фитнес-тренеров

## Общая структура проекта

```
TELEGRAMM_BOT_PROD/
├── bot.py                  # Основной файл запуска бота
├── config/                 # Конфигурационные файлы
│   ├── __init__.py
│   └── config.py           # Модуль загрузки конфигурации из .env
├── data/                   # Данные для RAG-системы
├── database/               # Модели и операции с БД
│   ├── __init__.py
│   ├── base.py             # Настройка подключения к базе данных
│   ├── models.py           # Модели базы данных
│   └── db_operations.py    # Операции с базой данных
├── handlers/               # Обработчики команд бота
│   ├── __init__.py
│   └── start.py            # Обработчики команд /start, /help и /about
├── keyboards/              # Клавиатуры и меню
│   └── __init__.py
├── models/                 # Модели данных и состояний
│   └── __init__.py
├── rag/                    # Система RAG для поиска информации
│   ├── __init__.py
│   ├── engine.py           # Основной движок RAG-системы
│   └── loaders.py          # Загрузчики документов для RAG-системы
├── services/               # Сервисы бизнес-логики
│   ├── __init__.py
│   ├── nutrition.py        # Сервис расчета КБЖУ
│   └── meal_planning.py    # Сервис генерации планов питания
├── venv_py311/             # Виртуальное окружение Python 3.11
├── requirements.txt        # Полный список зависимостей
├── requirements_minimal.txt # Минимальный набор зависимостей
├── .env                    # Файл с переменными окружения
└── .env.example            # Пример файла с переменными окружения
├── utils/                  # Вспомогательные функции
│   └── __init__.py
├── Doc/                    # Документация проекта
│   ├── PLAN_RAZRABOTKI.md  # План разработки проекта
│   ├── TZ_BOT.md           # Техническое задание
│   ├── JOURNAL.md          # Журнал разработки
│   └── ARCHITECTURE.md     # Описание архитектуры проекта
├── Rules/                  # Правила разработки
├── requirements.txt        # Зависимости проекта
├── .env.example            # Пример файла с переменными окружения
├── .gitignore              # Файлы, игнорируемые Git
└── README.md               # Общая информация о проекте
```

## Описание компонентов

### 1. Основные файлы

- **bot.py** - Точка входа в приложение, инициализирует бота и диспетчер, запускает поллинг.
- **.env.example** - Шаблон для настройки переменных окружения.
- **requirements.txt** - Список зависимостей проекта.
- **README.md** - Общее описание проекта, инструкции по установке и запуску.

### 2. Модули проекта

#### config/
- **config.py** - Загрузка и предоставление конфигурационных параметров из .env-файла для всего приложения.

#### database/
- **base.py** - Настройка подключения к базе данных, инициализация ORM, предоставление асинхронных сессий через AsyncSessionContextManager.
- **models.py** - Модели данных SQLAlchemy: клиенты, планы питания, ограничения.
- **db_handlers.py** - Асинхронные CRUD операции для работы с моделями базы данных.

#### handlers/
Обработчики команд и сообщений бота (будут добавлены по мере разработки):
- Команды меню
- Обработка диалогов для добавления клиентов
- Обработка действий с клиентами
- Генерация планов питания

#### keyboards/
Модули для создания клавиатур Telegram-бота:
- Главное меню
- Клавиатуры для диалогов
- Инлайн-клавиатуры для работы с клиентами

#### models/
Модели данных:
- Модели Pydantic для валидации данных
- Модели SQLAlchemy для базы данных
- Модели состояний для FSM (Finite State Machine)

#### rag/
Система поиска информации (Retrieval Augmented Generation):
- **loaders.py** - Загрузка и предобработка PDF-документов, разделение текста на чанки.
- **engine.py** - Основной движок RAG-системы с векторным поиском через FAISS и интеграцией с OpenAI.

#### services/
Бизнес-логика приложения:
- **nutrition.py** - Расчет КБЖУ по формуле Бенедикта с учетом пола, веса, роста, возраста, активности и целей.
- **meal_planning.py** - Генерация персонализированных планов питания с учетом КБЖУ и ограничений клиента.

#### utils/
Вспомогательные функции:
- Форматирования данных
- Логирование
- Другие утилиты

### 3. Документация

#### Doc/
- **PLAN_RAZRABOTKI.md** - План разработки проекта
- **TZ_BOT.md** - Техническое задание
- **JOURNAL.md** - Журнал разработки с хронологией выполненных задач
- **ARCHITECTURE.md** - Описание архитектуры проекта (текущий документ)

### 4. Взаимодействие компонентов

1. **Пользователь** отправляет команду боту в Telegram
2. **Aiogram** обрабатывает входящую команду и передает ее в соответствующий **обработчик**
3. **Обработчик** взаимодействует с **сервисами** для выполнения бизнес-логики
4. **Сервисы** используют **модели данных** и **базу данных** для хранения/получения информации
5. При необходимости используется **RAG-система** для поиска информации
6. Результат возвращается пользователю с использованием соответствующей **клавиатуры**

### 5. Технический стек

- **Python** - основной язык программирования (версия 3.11)
- **aiogram** - библиотека для работы с Telegram Bot API
- **SQLAlchemy** - асинхронная ORM для работы с базой данных
- **OpenAI API** - для генерации текстов с использованием GPT-4.1 nano
- **langchain** - для реализации RAG-системы
- **Pydantic** - для валидации данных
- **FAISS** - для эффективного векторного поиска в RAG-системе
- **greenlet** - для поддержки асинхронных операций

### 6. Окружения

Проект поддерживает три режима работы:
- **dev** - для разработки, с подробным логированием
- **test** - для тестирования
- **prod** - для продакшн, с минимальным логированием
