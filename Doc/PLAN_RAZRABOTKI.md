# План реализации проекта Telegram-бота для фитнес-тренеров

## Шаг 1: Настройка проекта и окружения

1. **Установка необходимых библиотек**:
   ```
   pip install aiogram==3.x openai langchain SQLAlchemy python-dotenv
   ```

2. **Создание структуры проекта**:
   ```
   mkdir -p config data database handlers keyboards models rag services utils
   touch .env bot.py
   ```

## Шаг 2: Настройка конфигурации проекта

1. **Создание файла конфигурации** (`config/config.py`):
   - Настройка параметров бота (токен Telegram, API ключ OpenAI)
   - Настройки базы данных
   - Пути к файлам RAG-системы

2. **Настройка .env файла**:
   ```
   # .env
   BOT_TOKEN=ваш_токен_телеграм
   OPENAI_API_KEY=ваш_ключ_openai
   ```

## Шаг 3: Создание модели базы данных

1. **Проектирование схемы базы данных** (`database/models.py`):
   - Таблица клиентов (id, имя, возраст, пол, рост, вес, уровень активности, цель, КБЖУ)
   - Таблица планов питания (id, клиент_id, дата, содержание_плана)
   - Таблица ограничений/аллергий (id, клиент_id, тип_ограничения, описание)

2. **Создание классов для работы с базой данных** (`database/db_operations.py`):
   - Функции CRUD для клиентов
   - Функции для работы с планами питания
   - Функции для работы с ограничениями

## Шаг 4: Разработка RAG-системы

1. **Создание структуры RAG** (`rag/engine.py`):
   - Реализация индексации и поиска по документам
   - Интеграция с OpenAI для генерации ответов

2. **Подготовка загрузчиков данных** (`rag/loaders.py`):
   - Загрузчики для PDF-файлов и таблиц
   - Предобработка данных

## Шаг 5: Создание сервисов бизнес-логики

1. **Сервис расчета КБЖУ** (`services/nutrition.py`):
   - Реализация формулы Бенедикта
   - Расчет КБЖУ на основе данных клиента

2. **Сервис генерации планов питания** (`services/meal_planning.py`):
   - Генерация планов питания с учетом КБЖУ и ограничений
   - Интеграция с RAG и OpenAI

## Шаг 6: Разработка интерфейса Telegram-бота

1. **Создание главного меню** (`keyboards/main_menu.py`):
   - Кнопки "Добавить нового клиента" и "Список клиентов"

2. **Создание клавиатур для диалогов** (`keyboards/dialog_keyboards.py`):
   - Клавиатуры выбора пола, уровня активности, цели
   - Клавиатура "Отмена" для процесса добавления клиента

3. **Реализация обработчиков команд** (`handlers/`):
   - `start.py`: Обработчик команды /start
   - `client_adding.py`: Обработчики для добавления клиента
   - `client_list.py`: Обработчики для работы со списком клиентов
   - `meal_plan.py`: Обработчики для генерации планов питания

## Шаг 7: Реализация машины состояний FSM

1. **Создание состояний** (`models/states.py`):
   - Состояния для добавления клиента
   - Состояния для редактирования клиента
   - Состояния для создания плана питания

2. **Реализация логики состояний** в соответствующих обработчиках

## Шаг 8: Интеграция с OpenAI

1. **Создание класса для работы с GPT-4.1 nano** (`services/ai_service.py`):
   - Методы для генерации ответов
   - Интеграция с RAG-системой

## Шаг 9: Написание основного файла бота

1. **Создание главного файла** (`bot.py`):
   - Инициализация бота
   - Регистрация обработчиков
   - Запуск цикла событий aiogram

## Шаг 10: Тестирование и отладка

1. **Написание тестов** для основных функций:
   - Тесты расчета КБЖУ
   - Тесты работы с базой данных
   - Тесты генерации планов питания

2. **Тестирование в режиме разработки**:
   - Проверка всех сценариев использования
   - Отладка обнаруженных ошибок

## Шаг 11: Документирование кода

1. **Добавление комментариев** на русском языке ко всем ключевым функциям и классам

2. **Создание README.md** с инструкциями по установке и запуску

## Шаг 12: Подготовка к деплою

1. **Создание Dockerfile** для контейнеризации приложения

2. **Настройка миграций базы данных** для будущего масштабирования

## Детальный план реализации основных функций

### Реализация добавления нового клиента:

1. Пользователь нажимает кнопку "Добавить нового клиента".
2. Бот запрашивает имя клиента.
3. Бот запрашивает возраст клиента.
4. Бот запрашивает пол (кнопки "Мужской"/"Женский").
5. Бот запрашивает рост в см.
6. Бот запрашивает вес в кг.
7. Бот запрашивает уровень активности (кнопки с разными уровнями).
8. Бот запрашивает цель (кнопки "Похудение"/"Набор массы"/"Поддержание веса").
9. Бот рассчитывает КБЖУ по формуле Бенедикта и показывает результат.
10. Бот предлагает добавить клиента в список (кнопка "Добавить в список клиентов").
11. На каждом шаге доступна кнопка "Отмена" для возврата в главное меню.

### Реализация списка клиентов:

1. Пользователь нажимает кнопку "Список клиентов".
2. Бот отображает список всех клиентов (имя + КБЖУ в краткой форме).
3. При выборе клиента бот показывает подробную информацию и кнопки:
   - "Редактировать"
   - "Удалить"
   - "Расписать план питания"

### Реализация генерации плана питания:

1. Пользователь выбирает клиента и нажимает "Расписать план питания".
2. Бот запрашивает ограничения/аллергии/предпочтения.
3. Бот использует RAG-систему и OpenAI для генерации плана на день (завтрак, обед, ужин) в соответствии с КБЖУ клиента.
4. Бот отображает план и предлагает сохранить его.